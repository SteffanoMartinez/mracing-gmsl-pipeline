/dts-v1/;
/plugin/;

#define CAM1_PWDN		0xa6
#define CAM_I2C_MUX 	0x13
#define GPIO_ACTIVE_HIGH 0

#define CAM1_LANES 2
#define CAM1_LANES_STRING "2"

/ {
	overlay-name = "AR0234 Integer Channel Fix";
	compatible = "nvidia,p3768-0000+p3767-0005-super",
	             "nvidia,p3767-0005",
	             "nvidia,tegra234";

	fragment@0 {
		target-path = "/";
		__overlay__ {
			ar0234_mclk: ar0234_fixed_clock {
				compatible = "fixed-clock";
				#clock-cells = <0>;
				clock-frequency = <24000000>;
			};
		};
	};

	fragment-camera-ar0234@1 {
		target-path = "/";
		__overlay__ {
			tegra-capture-vi  {
				num-channels = <1>;
				ports {
					#address-cells = <1>;
					#size-cells = <0>;

					vi_port0: port@0 {
						reg = <0>;

						vi_in0: endpoint {
							vc-id = <0>;
							port-index = <2>;
							bus-width = <CAM1_LANES>;
							remote-endpoint = <&csi_0_out>;
						};
					};
				};
			};

			tcp: tegra-camera-platform {
				compatible = "nvidia, tegra-camera-platform";
				num_csi_lanes = <CAM1_LANES>;
				max_lane_speed = <1500000>;
				min_bits_per_pixel = <10>;
				vi_peak_byte_per_pixel = <2>;
				vi_bw_margin_pct = <25>;

				modules {
					cam_module0: module0 {
						badge = "ar0234_custom";
						position = "front";
						orientation = "1";
						status = "okay";
						cam_module0_drivernode0: drivernode0 {
							pcl_id = "v4l2_sensor";
							status = "okay";
							sysfs-device-tree = "/sys/firmware/devicetree/base/bus@0/cam_i2cmux/i2c@1/max96724@28/i2c-mux/i2c@0/camera@40";
						};
					};
				};
			};

			bus@0 {
				host1x@13e00000 {
					nvcsi@15a00000 {
						#address-cells = <1>;
						#size-cells = <0>;

						num-channels = <1>;

						channel@0 {
							reg = <0>;
							status = "okay";
							ports {
								#address-cells = <1>;
								#size-cells = <0>;

								port@0 {
									reg = <0>;
									status = "okay";

									csi_0_in: endpoint@0 {
										status = "okay";
										port-index = <2>;
										bus-width = <CAM1_LANES>;
										remote-endpoint = <&ar0234_0_out>;
									};
								};

								port@1 {
									reg = <1>;
									status = "okay";

									csi_0_out: endpoint@1 {
										status = "okay";
										remote-endpoint = <&vi_in0>;
									};
								};
							};
						};
					};
				};

				cam_i2cmux {
					#address-cells = <1>;
					#size-cells = <0>;

					status = "okay";
					compatible = "i2c-mux-gpio";
					i2c-parent = <0x222>;
					mux-gpios = <0x105 CAM_I2C_MUX GPIO_ACTIVE_HIGH>;

					cam_i2c_1: i2c@1 {
						#address-cells = <1>;
						#size-cells = <0>;

						reg = <1>;
						status = "okay";

						des_1: max96724@28 {
							#address-cells = <1>;
							#size-cells = <0>;

							compatible = "maxim,max96724";
							reg = <0x28>;
							status = "okay";

							reset-gpios = <0xf3 CAM1_PWDN GPIO_ACTIVE_HIGH>;

							gpio-controller;
							#gpio-cells = <2>;

							i2c-mux {
								#address-cells = <1>;
								#size-cells = <0>;

								compatible = "i2c-mux-gpio";
								i2c-parent = <0x222>;
								mux-gpios = <0x105 CAM_I2C_MUX GPIO_ACTIVE_HIGH>;

								des_1_i2c_0: i2c@0 {
									#address-cells = <1>;
									#size-cells = <0>;

									reg = <0>;

									camera@40 {
										compatible = "onsemi,ar0234";

										reg = <0x40>;
										status = "okay";

										clocks = <&ar0234_mclk>;
										clock-names = "cam_mclk1";
										mclk = "cam_mclk1";

										physical_w = "15.0";
										physical_h = "12.5";

										sensor_model = "ar0234";
										use_sensor_mode_id = "true";
										post_crop_frame_drop = "0";

										/* CRITICAL: Use angle brackets for integer cells, NOT quotes */
										channel = <0x00000000>;
										sync_sensor_index = <0x00000000>;

										devnode = "video0";
										data-lanes = <CAM1_LANES>;

										mode0 {
											mclk_khz = "24000";
											num_lanes = CAM1_LANES_STRING;
											tegra_sinterface = "serial_c";
											phy_mode = "DPHY";
											vc_id = "0";
											discontinuous_clk = "no";
											dpcm_enable = "false";
											cil_settletime = "0";

											dynamic_pixel_bit_depth = "10";
											csi_pixel_bit_depth = "10";
											mode_type = "bayer";
											pixel_phase = "grbg";

											active_w = "1920";
											active_h = "1200";
											readout_orientation = "0";
											line_length = "2448";
											inherent_gain = "1";
											mclk_multiplier = "3.01";
											pix_clk_hz = "134400000";
											serdes_pix_clk_hz = "299000000";

											gain_factor = "100";
											min_gain_val = "100";
											max_gain_val = "1600";
											step_gain_val = "1";
											default_gain = "100";

											min_hdr_ratio = "1";
											max_hdr_ratio = "1";

											framerate_factor = "1000000";
											min_framerate = "30000000";
											max_framerate = "30000000";
											step_framerate = "1";
											default_framerate = "30000000";

											exposure_factor = "1000000";
											min_exp_time = "28";
											max_exp_time = "22000";
											step_exp_time = "1";
											default_exp_time = "22000";

											embedded_metadata_height = "0";
										};

										ports {
											#address-cells = <1>;
											#size-cells = <0>;
											port@0 {
												reg = <0>;

												ar0234_0_out: endpoint {
													vc-id = <0>;
													port-index = <2>;
													bus-width = <CAM1_LANES>;
													remote-endpoint = <&csi_0_in>;
												};
											};
										};
									};
								};

								des_1_i2c_1: i2c@1 {
									#address-cells = <1>;
									#size-cells = <0>;
									reg = <1>;
								};

								des_1_i2c_2: i2c@2 {
									#address-cells = <1>;
									#size-cells = <0>;
									reg = <2>;
								};

								des_1_i2c_3: i2c@3 {
									#address-cells = <1>;
									#size-cells = <0>;
									reg = <3>;
								};
							};

							phy@1 {
								reg = <1>;
							};

							pipe@0 {
								reg = <0>;
								status = "okay";

								maxim,phy-id = <1>;
							};

							channel@0 {
								reg = <0>;
								status = "okay";
								label = "des_1_ch_0";
								csi-port = "c";

								maxim,phy-id = <1>;

								clock-lanes = <0>;
								data-lanes = <1 2>;
								link-frequencies = /bits/ 64 <1250000000>;
							};
						};
					};

					cam_i2c_0: i2c@0 {
						#address-cells = <1>;
						#size-cells = <0>;

						reg = <0>;
						status = "okay";
					};
				};
			};
		};
	};
};